{% extends template.self %}

{% block head %}
    {{ super() }}
    <!-- Include CSS Override for custom styles -->
    <link rel="stylesheet" href="{{ "/_layouts/css-overrides/search-input-fix.css"|resolveFile }}">
    <link rel="stylesheet" href="{{ "/_layouts/css-overrides/image-fix.css"|resolveFile }}">
    
    <script>
        // More robust JavaScript to ensure search input styling is consistently applied
        document.addEventListener('DOMContentLoaded', function() {
            // Function to apply search styles
            function applySearchStyles() {
                try {
                    // Target all potential search inputs
                    var searchInputs = document.querySelectorAll('input[type="text"], input[type="search"], .book-search input, #book-search-input input, .book-summary input');
                    searchInputs.forEach(function(input) {
                        input.style.setProperty('background-color', '#141521', 'important');
                        input.style.setProperty('color', '#f8f8f2', 'important');
                        input.style.setProperty('opacity', '1', 'important');
                        input.style.setProperty('-webkit-text-fill-color', '#f8f8f2', 'important');
                        input.style.setProperty('border-color', '#2a2c3d', 'important');
                    });
                    
                    // Target search containers
                    var searchContainers = document.querySelectorAll('.book-search-input, .book-search, #book-search-input, .book-summary form');
                    searchContainers.forEach(function(container) {
                        container.style.setProperty('background-color', '#141521', 'important');
                    });
                    
                    console.log("Search styling applied successfully");
                } catch(e) {
                    console.error("Error applying search styles:", e);
                }
            }
            
            // Apply immediately
            applySearchStyles();
            
            // Apply at key moments when DOM might change
            window.setTimeout(applySearchStyles, 500);
            window.setTimeout(applySearchStyles, 1000);
            window.setTimeout(applySearchStyles, 2000);
            
            // Handle dynamic changes with a more efficient observer
            if (window.MutationObserver) {
                try {
                    var observer = new MutationObserver(function(mutations) {
                        var shouldApply = false;
                        
                        // Only apply styles if relevant elements were changed
                        mutations.forEach(function(mutation) {
                            if (mutation.addedNodes.length > 0 || 
                                (mutation.target && 
                                 (mutation.target.classList.contains('book-search-input') || 
                                  mutation.target.classList.contains('book-search') ||
                                  mutation.target.id === 'book-search-input' ||
                                  mutation.target.tagName === 'INPUT'))) {
                                shouldApply = true;
                            }
                        });
                        
                        if (shouldApply) {
                            applySearchStyles();
                        }
                    });
                    
                    observer.observe(document.body, { 
                        childList: true, 
                        subtree: true,
                        attributes: true,
                        attributeFilter: ['class', 'style']
                    });
                    
                    console.log("MutationObserver initialized successfully");
                } catch(e) {
                    console.error("Error setting up MutationObserver:", e);
                    // Fallback to interval-based updates
                    setInterval(applySearchStyles, 2000);
                }
            } else {
                // Fallback for browsers without MutationObserver
                setInterval(applySearchStyles, 2000);
            }
        });
    </script>
{% endblock %}

{% block body %}
    {{ super() }}
{% endblock %} 